# 3.1 Deposit interface
**Description：** 

- Request deposit, get the jump link of deposit

**Request URL：** 
- `/api/recharge/check/v2 `

**Request method：**
- GET

**Parameter(body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|p1 |yes|double | Deposit amount (usdt count) Example: 100.0 |
|p2 |yes|string |The merchant ID (UID) assigned by Bitake can be obtained from the BitakeApp->api configuration or https://merchant.bitake.io website |
|p3 |yes|string | Merchant order number, generated by the merchant, unique under the same merchant number  |
|p4 |no|string | The payment method can not be passed (CNY is the default if it is not passed). Please refer to the payment method list for specific values. When you pass a value other than CNY, VND, USD, you need to consult Bitake customer service to see if this payment method is enabled. |
|timestamp |yes|string | 10-bit timestamp  |

- Parameter encryption order： p1&p2&p3&timestamp 

- List of payment methods: CNY/VND/USD/INR/THB/HKD/MYR/EUR/GBP

|parameter name|payment method|
|:----    |:---|
|CNY |	Renminbi    | 
|VND |	Vietnamese Dong    | 
|USD |	U.S. dollar    | 
|INR |	Indian Rupee    | 
|THB |	Thai Baht    | 
|HKD |	Hong Kong dollar    | 
|MYR |	Malaysian Ringgit    | 
|EUR |	EUR    | 
|GBP |	GBP    | 

 **Return parameter description** 

```
{
	"code": 200,
	"data": {
		"url": "https://pay-api-ssl.bitake.io/mobile/buy?orderNo=USDT1609233285404590147&amount=100.0&usdtAmount=100.0&exchangeRate=1.0&merchantName=Bitake+Demo&closeCurrency=CNY"
	},
	"message": "success"
}
```

- Note: After obtaining the url, you can directly redirect to this url, and you can only redirect once

- Note: If the merchant crm wants to deposit funds to users according to their platform's deposit exchange rate,
  For example, the merchant's crm deposit exchange rate is 6.6
  The deposit rate of bitake is 6.5 (can be found through the bitake quotation interface)
  The user deposits 100 USD in the crm
  At this time, the amount the user needs to pay is 100*6.6=660 RMB
  Only need to use 100*6.6/6.5=101.538462 (result with 6 significant digits after the decimal point) as the bitake deposit interface p1 (the number of deposit usdt) to pass, the user payment amount is 660 yuan
  When calling back, the merchant crm finds out that the user’s credited amount in the crm is 100 US dollars based on the order number at the time of the callback, and 100 US dollars for the user
  The final effect is:
    1. The user deposits 100 USD in the crm
    2. The user pays 660 RMB
    3. Merchants get 101.538462* (1-deposit fee) USDT in bitake  

# 3.2 Check USDT quotation    

**Description：** 

- Inquiry for Quotation

**Request URL：** 
- `/api/recharge/convert/v1 `

**Request method：**
- GET

**parameter(body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|p1 |yes|string | Merchant's Merchant ID (UID)  |
|p2 |no|string |Fiat currency type (not involved in encryption) can not be transmitted, the default is CNY |
|p3|yes|string|Deposit amount (fiat currency amount) (not involved in encryption) If p2 is CNY, p3 is the amount of CNY|
|timestamp |yes|string | 10-bit timestamp  |

- Parameter encryption order： p1&timestamp

 **Return parameter description** 

```
{
    "code":200,
    "data":{
        "price":6.46 //USDT quotation (exchange rate) on the Bitake platform, that is, the price of buying a usdt corresponding to the legal currency
    },
    "message":"success"
}
```
 **Request example** 
 ```
 curl -X GET -H "content-type:application/json" -H "access_key:8A42FADDD2397F4841B1F85C2C13094CAB152151" -H "app_id:41043343" http://merchant-api.bitake.io/api/recharge/convert/v1?timestamp=1609385362&p1=9357&p2=CNY&p3=695
 ```

# 3.3 Deposit，Directly to return the order data

**Description：** 

- Deposit directly returns the order data. Merchants can call this interface when they need to do the cashier page in their crm system. If you use the cashier provided by Bitake, please use 3.1 deposit interface
- Call this interface to deposit. After the user makes the payment, the user needs to call the 3.4 user click paid interface to mark the order status as paid, otherwise the acceptor cannot release the order, and the order cannot be completed
**Request URL：** 
- `/api/recharge/check/v3 `

**Request method：**
- GET

**Parameters (body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|p1 |yes|string | Deposit amount (USDT)  |
|p2 |yes|string |Merchant's Merchant ID (UID) |
|p3|yes|string|Merchant order number|
|p4|no|string|fiat currency , the default is CNY|
|timestamp |yes|string | 10-bit timestamp  |

- Parameter encryption order： p1&p2&p3&timestamp

 **Return parameter description** 

```
}
    "code":200,
    "data":{
        marketPrice":6.91,
        currencyFee":1.0,
        payEffivetTime":10.0,
        remark":"用户入金购买订单",
        invsetPoint":0,
        realCurrencyCount":99.0,
        "floatPoint":0.0086,
        "currency":"USDT",      // currency
        "id":50272,
        "state":1,
        "investUserId":490,
        "tradeCloseCurrency":"CNY", //payment type fiat currency
        "depositOrderNo":"USDT1597136633878653397",
        "investCurrencyCount":100.0,        //USDT amount
        "orderNo":"USDT159713663390201",
        "headImg":null,
        "userChannels":[ //payment method
             {
                "realName":"吴冰涛",
                "depositBank":"支付宝",
                "createTime":1596148869000,
                "nickName":"专业承兑商",
                "cardImgUrl":"/picture/upIb/17729779995_1596148869865_.png",
                "updateTime":1596148869000,
                "id":386,
                "bankAddress":"支付宝",
                "userId":531,
                "cardNumber":"13253663580@163.com",
                "channelId":2
             }],
        "nickName":"专业承兑商",
        "tradeCountMonth":36476.48,
        "currentPrice":6.97,     //unit price
        "bidId":594,
        "bidUserId":531,
        "currencyTypeId":1,
        "realName":"吴冰涛",
        "areaId":1,
        "tradeCount":17,
        "createTime":"2020-08-1117:03:53",
        "serial":"390201",  /Remark reference number
        "investAmount":697.0,  //fiat currency amount
        "lastEffivectTime":"2020-08-1117:13:53"
    },
    "message":"success"
}
```
# 3.4 User clicks paid
**Description：** 

- When the user clicks on paid and calls the 3.3 interface to deposit, this interface needs to be called to confirm the payment

**Request URL：** 
- `/api/recharge/pay/complete `

**Request method：**
- GET

**Parameters (body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|p1|yes|string|Merchant order number|
|p2|yes|string|Customer's real name (used to verify the payer's information)|
|timestamp |yes|string | 10-bit timestamp  |

- Parameter encryption order： p1&p2&p3&p4&timestamp

 **Return parameter description** 

```
{
    "code":200, //成功
    "message":"success" 
}
```
```
{
    "code":500, //失败
    "message":"您已点击过，无需再次点击" 
}
```
# 3.5 Deposit (integrate into your own system, digital currency deposit)
**Description：** 

- Deposit is integrated into your own system. For digital currency deposits, merchants need to do the cash register page in their crm system, and when the payment method is only digital currency, they can call this interface to deposit .

**Request URL：** 
- `/api/recharge/check/v4 `

**Request method：**
- GET

**Parameters (body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|p1 |yes|Double | Deposit amount (USDT)  |
|p2 |yes|string |Merchant's Merchant ID (UID) |
|p3|yes|string|Merchant order number|
|p4|yes|int|Digital currency payment type: 1 USDT 2 BTC 3 ETH|
|timestamp |yes|string | 10-bit timestamp  |

- Parameter encryption order： p1&p2&p3&p4&timestamp

 **Return parameter description** 

```
{
    "code":200,
    "data":{
        "usdAmount":11988.6, //U.S. dollar equivalent
        "address":"1f5s4fdsfd1f23f4ds864f51s2f15sdf4s6f4sf1e2", //Wallet address
        "orderNo":"USDT1556487965324", //Bitake order number
        "currency":"USDT", //Deposit currency
        "merchantOrderNo":"PAY1604297618", //Merchant order number
        "currencyCount":30  //Deposit amount
    },
    "message":"success"
}
```
- Note: The user transfers the (currencyCount) (currency) to the wallet address (address) on other platforms (such as Huobi), the transaction is completed, and the callback is automatically called back


# 3.6 Asynchronous notification of merchant deposit (callback)
**Description：** 

- Asynchronous notification of merchant deposits requires merchants to develop their own callback interface. When the order is completed, Bitake will call this interface to notify merchants of the deposit result.

**Request URL：** 
- The merchant configures the callback address through the Bitake APP or log in to the Bitake merchant website (https://merchant.bitake.io).

**Request method：**
- POST

**Parameters (body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|amount|yes|Double|Deposit amount (amount of USDT)|
|exchangeRate|yes|Double|Currently fixed at 1.0, meaningless|
|poundage|yes|Double|Handling fee|
|merchantNo|yes|string|Merchant's Merchant ID (UID)|
|merchantOrderNo|yes|string|Merchant order number|
|orderNo|yes|string|Bitake Order Number|
|sign|yes|sting|签名|
|timestamp |yes|string | 10-bit timestamp  |
|currency|no|string|Deposit coins such as: USDT (ERC20)|
|fiatCurrency |no|string | payment method fiat currency, example:CNY  |
|fiatRate |no|Double | Deposit rate, example：6.43  |
|fiatAmount |no|Double | fiat currency amount example：1000.00  |
|payerName |no|string | Payer's name  |
- Parameter encryption order：amount&exchangeRate&poundage&merchantNo&merchantOrderNo&orderNo&timestamp
- Configure key encryption through the merchant background. Merchants should verify the data strictly in accordance with the signature rules to ensure the security and legality of the data.

**Receive return value format:**

```
{
    "code":200
}
```
Or
```
success
```
- After receiving the notification, the merchant returns {"code":200} or success string, otherwise Bitake regards that the merchant has not successfully received the notification, and uses the following repeated notification strategy to continue the notification: 15s-3m-10m-30m-1h- 2h-6h-15h
- If the merchant does not return the success code within the notification policy time, Bitake regards the merchant's service as abnormal and abandons the order notification. The relevant order status can be queried on the merchant platform
- Asynchronous notification will only be triggered after the merchant’s order is successfully completed. Therefore, the failure of the asynchronous notification does not mean that the payment has failed.

# 3.7 Query deposit order status
**Description：** 

- Query deposit order status

**Request URL：** 
- `/api/recharge/order/query `

**Request method：**
- GET

**Parameters (body)：** 

|parameter name|required|type|Description|
|:----    |:---|:----- |-----   |
|merchantNo |yes|string | Merchant's Merchant ID (UID)  |
|merchantOrderNo |yes|string |Merchant order number  |
|timestamp |yes|string | 10-bit timestamp  |

- Parameter encryption order： merchantNo&timestamp

 **Return parameter description** 

```  
    {
    "code":200,
    "data":{
        "amount":"100.0", //Deposit amount
        "orderNo":"USDT1604313780523380140",//Bitake Order Number
        "fiatRate":"6.68", //Deposit rate, example：6.43
        "poundage":"1.0", //fee（USDT）
        "sign":"B129F34A67724AB3B5BF787CB96D5859BC68B54F",
        "merchantOrderNo":"160431378122", //Merchant order number
        "orderState":"3", //Order status -1 Expired -3 Canceled  1 Init 2 Paid 3 Succeed
        "fiatAmount":"668.0", //fiat currency amount, example：1000.00
        "fiatCurrency":"CNY", //fiat currency, example：CNY
        "payerName":"测试", //Payer's name
        "currency":"USDT", //deposit currency, example ：USDT
        "state":"1", Callback State ： 0: Init 1:Deposit Succeed ；2:Callback Succeed
        "merchantNo":"9357",  //Merchant order number
        "timestamp":"1617758947" //Timestamp
    },
    "message":"success"
}

```
- Callback State（state）: When it is 1, it means that the order has been paid successfully, but an error occurred when calling back the merchant's callback address, or the callback address did not return the correct result. Please check whether the callback address is filled in incorrectly, whether it can be adjusted, and whether the correct result is returned ({"Code:200} or success string)
- Order State（orderState）:When it is -1, -3, it means the order has failed, when it is 3, it means it has succeeded, when it is 1, 2, it means the order is in progress

